# golem-wasm-rpc-stubgen

The `golem-wasm-rpc-stubgen` is a CLI tool to generate the RPC stubs from a component's WIT definition.

## Generate

```shell
Usage: wasm-rpc-stubgen generate [OPTIONS] --source-wit-root <SOURCE_WIT_ROOT> --dest-crate-root <DEST_CRATE_ROOT>

Options:
  -s, --source-wit-root <SOURCE_WIT_ROOT>                
  -d, --dest-crate-root <DEST_CRATE_ROOT>                
  -w, --world <WORLD>                                    
      --stub-crate-version <STUB_CRATE_VERSION>          [default: 0.0.1]
      --wasm-rpc-path-override <WASM_RPC_PATH_OVERRIDE>  
  -h, --help                                             Print help
  -V, --version                                          Print version
```

- `source-wit-root`: The root directory of the component's WIT definition to be called via RPC
- `dest-crate-root`: The target path to generate a new stub crate to
- `world`: The world name to be used in the generated stub crate. If there is only a single world in the source root
  package, no need to specify.
- `stub-crate-version`: The crate version of the generated stub crate
- `wasm-rpc-path-override`: The path to the `wasm-rpc` crate to be used in the generated stub crate. If not specified,
  the latest version of `wasm-rpc` will be used.

The command creates a new Rust crate that is ready to be compiled with

```shell
cargo component build --release
```

The resulting WASM component implements the **stub interface** corresponding to the source interface, found in the
target directory's
`wit/_stub.wit` file. This WASM component is to be composed together with another component that calls the original
interface via WASM RPC.

## Build

```
Usage: wasm-rpc-stubgen build [OPTIONS] --source-wit-root <SOURCE_WIT_ROOT> --dest-wasm <DEST_WASM> --dest-wit-root <DEST_WIT_ROOT>

Options:
  -s, --source-wit-root <SOURCE_WIT_ROOT>                
      --dest-wasm <DEST_WASM>                            
      --dest-wit-root <DEST_WIT_ROOT>                    
  -w, --world <WORLD>                                    
      --stub-crate-version <STUB_CRATE_VERSION>          [default: 0.0.1]
      --wasm-rpc-path-override <WASM_RPC_PATH_OVERRIDE>  
  -h, --help                                             Print help
  -V, --version                                          Print version
```

- `source-wit-root`: The root directory of the component's WIT definition to be called via RPC
- `dest-wasm`: The name of the stub WASM file to be generated
- `dest-wit-root`: The directory name where the generated WIT files should be placed
- `world`: The world name to be used in the generated stub crate. If there is only a single world in the source root
  package, no need to specify.
- `stub-crate-version`: The crate version of the generated stub crate
- `wasm-rpc-path-override`: The path to the `wasm-rpc` crate to be used in the generated stub crate. If not specified,
  the latest version of `wasm-rpc` will be used. It needs to be an **absolute path**.

## Add stub WIT dependency

```shell
Usage: wasm-rpc-stubgen add-stub-dependency [OPTIONS] --stub-wit-root <STUB_WIT_ROOT> --dest-wit-root <DEST_WIT_ROOT>

Options:
  -s, --stub-wit-root <STUB_WIT_ROOT>  
  -d, --dest-wit-root <DEST_WIT_ROOT>  
  -o, --overwrite                      
  -h, --help                           Print help
  -V, --version                        Print version
```

The command merges a generated RPC stub as a WIT dependency into an other component's WIT root.

- `stub-wit-root`: The WIT root generated by either `generate` or `build` command
- `dest-wit-root`: The WIT root of the component where the stub should be added as a dependency
- `overwrite`: This command would not do anything if it detects that it would change an existing WIT file's contents at
  the destination. With this flag, it can be forced to overwrite those files.